<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Friday, February 22, 2019, 1:13 AM -->
<!-- MuClient version 5.04 -->

<!-- Plugin "ConvertShopPrices" generated by Plugin Wizard -->

<muclient>
<plugin
   name="ConvertShopPrices"
   author="Ruhsbaar"
   id="a3d0068ddae76a2c1e113ffc"
   language="Lua"
   purpose="Convert shop prices to $A"
   save_state="y"
   date_written="2019-02-22 01:12:18"
   requires="5.04"
   version="1.0"
   >

</plugin>


<!--  Get our standard constants -->

<include name="constants.lua"/>

<!--  Triggers  -->

<triggers>
  <trigger
   enabled="y"
   match="^   (\w): (.*) for (.*) \((\w+) left\)\.$"
   regexp="y"
   omit_from_output="y"
   send_to="12"
   sequence="100"
  >
  <send>function w2am(data)
  return data / 400
end

function parse_price(data)
  local total = 0
  -- Determine what kind of currency we're dealing with
  if string.find(data, 'L') ~= nil then
    -- Lancre
    --print('BP Value: ' .. data .. ', AM Value: ' .. total)
  elseif string.find(data, 'G') ~= nil then
    -- Genua
    --print('BP Value: ' .. data .. ', AM Value: ' .. total)
  elseif string.find(data, 'de') ~= nil or string.find(data, 'S') ~= nil or string.find(data, 'M') ~= nil then
    -- Ephebe
    local de = (string.match(data, "(%d+)de") or 0) * 2
    local s = (string.match(data, "S(%d+)") or 0) * 192
    local m = (string.match(data, "(%d+)M") or 0) * 9600
    total = w2am(m+s+de)
  elseif string.find(data, 'DjToon') ~= nil then
    -- Djelibeybi
    local tn = (string.match(data, "DjToon %d+%.(%d+)") or 0) * 2
    local pt = (string.match(data, "DjToon (%d+)%.%d+") or 0) * 200
    total = w2am(pt+tn)
  elseif string.find(data, 's') ~= nil or string.find(data, 'Rh') ~= nil then
    -- Bes Pelargic
    local sr = (string.match(data, "(%d+)s") or 0) * 4
    local rh = (string.match(data, "(%d+)Rh") or 0) * 480
    total = w2am(sr+rh)
  end

  return total
end

if GetVariable("ConvertShopPrices") == "1" then
  Note('%1: %2 for %3 (%4 left). [' .. parse_price("%3") .. ']')
end</send>
  </trigger>
</triggers>

<!--  Aliases  -->

<aliases>
  <alias
   match="convertprices on"
   enabled="y"
   send_to="12"
   sequence="100"
  >
  <send>SetVariable("ConvertShopPrices", 1)
Note("Will now display converted shop prices.")</send>
  </alias>
  <alias
   match="convertprices off"
   enabled="y"
   send_to="12"
   sequence="100"
  >
  <send>SetVariable("ConvertShopPrices", 0)
Note("Will no longer show converted prices.")</send>
  </alias>
</aliases>

<!--  Variables  -->

<variables>
  <variable name="ConvertShopPrices">1</variable>
</variables>

</muclient>
